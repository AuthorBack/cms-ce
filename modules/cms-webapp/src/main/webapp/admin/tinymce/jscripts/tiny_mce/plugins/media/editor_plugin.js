(function(){var D=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),H=tinymce.makeMap(D.join(",")),B=tinymce.html.Node,F,A,G=tinymce.util.JSON,E;F=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"]];function C(L){var K,I,J;if(L&&!L.splice){I=[];for(J=0;true;J++){if(L[J]){I[J]=L[J]}else{break}}return I}return L}tinymce.create("tinymce.plugins.MediaPlugin",{init:function(M,I){var Q=this,K={},L,O,P,J;function N(R){return R&&R.nodeName==="IMG"&&M.dom.hasClass(R,"mceItemMedia")}Q.editor=M;Q.url=I;A="";for(L=0;L<F.length;L++){J=F[L][0];P={name:J,clsids:tinymce.explode(F[L][1]||""),mimes:tinymce.explode(F[L][2]||""),codebase:F[L][3]};for(O=0;O<P.clsids.length;O++){K["clsid:"+P.clsids[O]]=P}for(O=0;O<P.mimes.length;O++){K[P.mimes[O]]=P}K["mceItem"+J]=P;K[J.toLowerCase()]=P;A+=(A?"|":"")+J}tinymce.each(M.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mp3,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar").split(";"),function(U){var R,T,S;U=U.split(/=/);T=tinymce.explode(U[1].toLowerCase());for(R=0;R<T.length;R++){S=K[U[0].toLowerCase()];if(S){K[T[R]]=S}}});A=new RegExp("write("+A+")\\(([^)]+)\\)");Q.lookup=K;M.onPreInit.add(function(){M.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]");M.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(R){var S=R.length;while(S--){Q.objectToImg(R[S])}});M.serializer.addNodeFilter("img",function(R,T,S){var U=R.length,V;while(U--){V=R[U];if((V.attr("class")||"").indexOf("mceItemMedia")!==-1){Q.imgToObject(V,S)}}})});M.onInit.add(function(){if(M.theme&&M.theme.onResolveName){M.theme.onResolveName.add(function(R,S){if(S.name==="img"&&M.dom.hasClass(S.node,"mceItemMedia")){S.name="media"}})}if(M&&M.plugins.contextmenu){M.plugins.contextmenu.onContextMenu.add(function(S,T,R){if(R.nodeName==="IMG"&&R.className.indexOf("mceItemMedia")!==-1){T.add({title:"media.edit",icon:"media",cmd:"mceMedia"})}})}});M.addCommand("mceMedia",function(){var S,R;R=M.selection.getNode();if(N(R)){S=G.parse(M.dom.getAttrib(R,"data-mce-json"));tinymce.each(D,function(T){var U=M.dom.getAttrib(R,T);if(U){S[T]=U}});S.type=Q.getType(R.className).name.toLowerCase()}if(!S){S={type:"flash",video:{sources:[]},params:{}}}M.windowManager.open({file:I+"/media.htm",width:430+parseInt(M.getLang("media.delta_width",0)),height:500+parseInt(M.getLang("media.delta_height",0)),inline:1},{plugin_url:I,data:S})});M.addButton("media",{title:"media.desc",cmd:"mceMedia"});M.onNodeChange.add(function(S,R,T){R.setActive("media",N(T))})},convertUrl:function(K,N){var J=this,M=J.editor,L=M.settings,O=L.url_converter,I=L.url_converter_scope||J;if(!K){return K}if(N){return M.documentBaseURI.toAbsolute(K)}return O.call(I,K,"src","object")},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(L,J){var Q=this,N=Q.editor,O=N.documentBaseURI,I,P,M,K;L.params.src=Q.convertUrl(L.params.src,J);P=L.video.attrs;if(P){P.src=Q.convertUrl(P.src,J)}if(P){P.poster=Q.convertUrl(P.poster,J)}I=C(L.video.sources);if(I){for(K=0;K<I.length;K++){I[K].src=Q.convertUrl(I[K].src,J)}}M=Q.editor.dom.create("img",{id:L.id,style:L.style,align:L.align,src:Q.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+Q.getType(L.type).name,"data-mce-json":G.serialize(L,"'")});M.width=L.width||"320";M.height=L.height||"240";return M},dataToHtml:function(I,J){return this.editor.serializer.serialize(this.dataToImg(I,J),{force_absolute:J})},htmlToData:function(K){var J,I,L;L={type:"flash",video:{sources:[]},params:{}};J=this.editor.parser.parse(K);I=J.getAll("img")[0];if(I){L=G.parse(I.attr("data-mce-json"));L.type=this.getType(I.attr("class")).name.toLowerCase();tinymce.each(D,function(M){var N=I.attr(M);if(N){L[M]=N}})}return L},getType:function(L){var J,I,K;I=tinymce.explode(L," ");for(J=0;J<I.length;J++){K=this.lookup[I[J]];if(K){return K}}},imgToObject:function(W,M){var S=this,N=S.editor,Z,d,I,R,e,V,c,T,J,b,Q,O,X,a,L,U,K,Y;function P(f,g){var k,j,l,i,h;h=N.getParam("flash_video_player_url",S.convertUrl(S.url+"/moxieplayer.swf"));if(h){k=N.documentBaseURI;c.params.src=h;if(N.getParam("flash_video_player_absvideourl",true)){f=k.toAbsolute(f||"",true);g=k.toAbsolute(g||"",true)}l="";j=N.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"});tinymce.each(j,function(n,m){n=n.replace(/\$url/,f||"");n=n.replace(/\$poster/,g||"");if(n.length>0){l+=(l?"&":"")+m+"="+escape(n)}});if(l.length){c.params.flashvars=l}i=N.getParam("flash_video_player_params",{allowfullscreen:true,allowscriptaccess:true});tinymce.each(i,function(n,m){c.params[m]=""+n})}}c=G.parse(W.attr("data-mce-json"));O=this.getType(W.attr("class"));Y=W.attr("data-mce-style");if(!Y){Y=W.attr("style");if(Y){Y=N.dom.serializeStyle(N.dom.parseStyle(Y,"img"))}}if(O.name==="Iframe"){U=new B("iframe",1);tinymce.each(D,function(f){var g=W.attr(f);if(f=="class"&&g){g=g.replace(/mceItem.+ ?/g,"")}if(g&&g.length>0){U.attr(f,g)}});for(e in c.params){U.attr(e,c.params[e])}U.attr({style:Y,src:c.params.src});if(c.object_html){V=new B("#text",3);V.raw=true;V.value=c.object_html;U.append(V)}W.replace(U);return }if(this.editor.settings.media_use_script){U=new B("script",1).attr("type","text/javascript");V=new B("#text",3);V.value="write"+O.name+"("+G.serialize(tinymce.extend(c.params,{width:W.attr("width"),height:W.attr("height")}))+");";U.append(V);W.replace(U);return }if(O.name==="Video"&&c.video.sources[0]){Z=new B("video",1).attr(tinymce.extend({id:W.attr("id"),width:W.attr("width"),height:W.attr("height"),style:Y},c.video.attrs));if(c.video.attrs){K=c.video.attrs.poster}J=c.video.sources=C(c.video.sources);for(X=0;X<J.length;X++){if(/\.mp4$/.test(J[X].src)){L=J[X].src}}if(!J[0].type){Z.attr("src",J[0].src);J.splice(0,1)}for(X=0;X<J.length;X++){T=new B("source",1).attr(J[X]);T.shortEnded=true;Z.append(T)}if(L){P(L,K);O=S.getType("flash")}else{c.params.src=""}}if(c.params.src){if(/\.flv$/i.test(c.params.src)){P(c.params.src,"")}if(M&&M.force_absolute){c.params.src=N.documentBaseURI.toAbsolute(c.params.src)}d=new B("object",1).attr({id:W.attr("id"),width:W.attr("width"),height:W.attr("height"),style:Y});tinymce.each(D,function(f){if(c[f]&&f!="type"){d.attr(f,c[f])}});for(e in c.params){Q=new B("param",1);Q.shortEnded=true;V=c.params[e];if(e==="src"&&O.name==="WindowsMedia"){e="url"}Q.attr({name:e,value:V});d.append(Q)}if(this.editor.getParam("media_strict",true)){d.attr({data:c.params.src,type:O.mimes[0]})}else{d.attr({classid:"clsid:"+O.clsids[0],codebase:O.codebase});I=new B("embed",1);I.shortEnded=true;I.attr({id:W.attr("id"),width:W.attr("width"),height:W.attr("height"),style:Y,type:O.mimes[0]});for(e in c.params){I.attr(e,c.params[e])}tinymce.each(D,function(f){if(c[f]&&f!="type"){I.attr(f,c[f])}});d.append(I)}if(c.object_html){V=new B("#text",3);V.raw=true;V.value=c.object_html;d.append(V)}if(Z){Z.append(d)}}if(Z){if(c.video_html){V=new B("#text",3);V.raw=true;V.value=c.video_html;Z.append(V)}}if(Z||d){W.replace(Z||d)}else{W.remove()}},objectToImg:function(X){var e,I,Z,O,f,g,T,V,S,a,Y,P,N,c,W,J,d,M,b=this.lookup,K,U,R=this.editor.settings.url_converter,L=this.editor.settings.url_converter_scope;function Q(h){return new tinymce.html.Serializer({inner:true,validate:false}).serialize(h)}if(!X.parent){return }if(X.name==="script"){if(X.firstChild){K=A.exec(X.firstChild.value)}if(!K){return }M=K[1];d={video:{},params:G.parse(K[2])};V=d.params.width;S=d.params.height}d=d||{video:{},params:{}};f=new B("img",1);f.attr({src:this.editor.theme.url+"/img/trans.gif"});g=X.name;if(g==="video"){Z=X;e=X.getAll("object")[0];I=X.getAll("embed")[0];V=Z.attr("width");S=Z.attr("height");T=Z.attr("id");d.video={attrs:{},sources:[]};U=d.video.attrs;for(g in Z.attributes.map){U[g]=Z.attributes.map[g]}W=X.attr("src");if(W){d.video.sources.push({src:R.call(L,W,"src","video")})}J=Z.getAll("source");for(Y=0;Y<J.length;Y++){W=J[Y].remove();d.video.sources.push({src:R.call(L,W.attr("src"),"src","source"),type:W.attr("type"),media:W.attr("media")})}if(U.poster){U.poster=R.call(L,U.poster,"poster","video")}}if(X.name==="object"){e=X;I=X.getAll("embed")[0]}if(X.name==="embed"){I=X}if(X.name==="iframe"){O=X;M="Iframe"}if(e){V=V||e.attr("width");S=S||e.attr("height");a=a||e.attr("style");T=T||e.attr("id");c=e.getAll("param");for(Y=0;Y<c.length;Y++){N=c[Y];g=N.remove().attr("name");if(!H[g]){d.params[g]=N.attr("value")}}d.params.src=d.params.src||e.attr("data")}if(I){V=V||I.attr("width");S=S||I.attr("height");a=a||I.attr("style");T=T||I.attr("id");for(g in I.attributes.map){if(!H[g]&&!d.params[g]){d.params[g]=I.attributes.map[g]}}}if(O){V=O.attr("width");S=O.attr("height");a=a||O.attr("style");T=O.attr("id");tinymce.each(D,function(h){f.attr(h,O.attr(h))});for(g in O.attributes.map){if(!H[g]&&!d.params[g]){d.params[g]=O.attributes.map[g]}}}if(d.params.movie){d.params.src=d.params.src||d.params.movie;delete d.params.movie}if(d.params.src){d.params.src=R.call(L,d.params.src,"src","object")}if(Z){M=b.video.name}if(e&&!M){M=(b[(e.attr("clsid")||"").toLowerCase()]||b[(e.attr("type")||"").toLowerCase()]||{}).name}if(I&&!M){M=(b[(I.attr("type")||"").toLowerCase()]||{}).name}X.replace(f);if(I){I.remove()}if(e){P=Q(e.remove());if(P){d.object_html=P}}if(Z){P=Q(Z.remove());if(P){d.video_html=P}}if(O){P=Q(O.remove());if(P){d.object_html=P}}f.attr({id:T,"class":"mceItemMedia mceItem"+(M||"Flash"),style:a,width:V||"320",height:S||"240","data-mce-json":G.serialize(d,"'")})}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();