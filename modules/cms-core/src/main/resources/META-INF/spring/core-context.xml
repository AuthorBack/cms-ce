<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">

  <context:annotation-config/>
  <context:property-placeholder/>

  <context:component-scan base-package="com.enonic.cms.core"/>
  <context:component-scan base-package="com.enonic.cms.store"/>
  <context:component-scan base-package="com.enonic.cms.business"/>
  <context:component-scan base-package="com.enonic.cms.framework"/>

  <bean id="verticalProperties" class="com.enonic.vertical.VerticalProperties"/>

  <tx:annotation-driven transaction-manager="transactionManager"/>

  <bean id="dataSource" class="com.enonic.cms.store.support.DataSourceFactory">
    <property name="jndiName" value="java:comp/env/jdbc/cms"/>
  </bean>

  <bean id="dialect" class="com.enonic.cms.framework.jdbc.dialect.DialectFactory"/>

  <bean id="sessionFactory" class="com.enonic.cms.store.support.HibernateConfigurator"/>

  <bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
    <property name="sessionFactory" ref="sessionFactory"/>
  </bean>

  <bean id="decoratorManager" class="com.enonic.cms.store.support.DecoratorManager"/>

  <bean id="connectionFactory" class="com.enonic.cms.store.support.ConnectionFactory"/>

  <bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
    <property name="dataSource" ref="dataSource"/>
    <property name="sessionFactory" ref="sessionFactory"/>
    <property name="defaultTimeout" value="${cms.tx.defaultTimeout}"/>
  </bean>

  <bean name="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
    <property name="transactionManager" ref="transactionManager"/>
  </bean>

  <bean id="databaseInitializer" class="com.enonic.cms.core.jdbc.DatabaseInitializer"/>
  <bean id="keyService" class="com.enonic.cms.core.service.KeyServiceImpl"/>

  <bean id="upgradePropertyResolver" class="com.enonic.cms.upgrade.service.StandardPropertyResolver"/>

  <bean id="upgradeService" class="com.enonic.cms.upgrade.service.UpgradeServiceImpl">
    <property name="transactionTemplate" ref="transactionTemplate"/>
  </bean>

  <bean id="dataSourceService" class="com.enonic.cms.core.service.DataSourceServiceImpl"/>

  <bean id="userServicesEngine" class="com.enonic.vertical.engine.UserServicesEngine"/>
  <bean id="userServicesService" class="com.enonic.cms.core.service.UserServicesServiceImpl"/>

  <bean id="tightestCacheSettingsResolver" class="com.enonic.cms.core.TightestCacheSettingsResolver"/>

  <bean id="resolverInputXMLCreator" class="com.enonic.cms.core.resolver.ResolverInputXMLCreator"/>

  <bean id="resolverXMLCreator" class="com.enonic.cms.core.resolver.ResolverHttpRequestInputXMLCreator"/>

  <bean id="resolverInputCreator" class="com.enonic.cms.core.resolver.ResolverHttpRequestInputCreator"/>

  <bean id="cookieOrSessionForcedResolverValueService"
        class="com.enonic.cms.core.resolver.ForceResolverValueServiceImpl"/>

  <bean id="sessionCachedResolverValueService" class="com.enonic.cms.core.resolver.CacheResolverValueServiceImpl"/>

  <bean id="deviceClassificationService"
        class="com.enonic.cms.core.resolver.deviceclass.DeviceClassResolverServiceImpl">
    <property name="deviceClassScriptResolver" ref="deviceClassXsltScriptResolver"/>
    <property name="forceResolverValueService" ref="cookieOrSessionForcedResolverValueService"/>
    <property name="cacheResolverValueService" ref="sessionCachedResolverValueService"/>
  </bean>

  <bean id="localizeService" class="com.enonic.cms.core.localization.LocalizationServiceImpl"/>

  <bean id="localizationResourceBundleService"
        class="com.enonic.cms.core.localization.resource.LocalizationResourceBundleServiceImpl">
  </bean>

  <bean id="localeResolverService"
        class="com.enonic.cms.core.resolver.locale.LocaleResolverServiceImpl">
    <property name="localeScriptResolver" ref="localeXsltScriptResolver"/>
    <property name="forceResolverValueService" ref="cookieOrSessionForcedResolverValueService"/>
  </bean>

  <bean id="localeXsltScriptResolver"
        class="com.enonic.cms.core.resolver.locale.LocaleXsltScriptResolver"/>

  <bean id="adminConsoleTranslationService"
        class="com.enonic.cms.core.AdminConsoleTranslationService" init-method="init">
    <property name="defaultLanguageCode" value="${cms.admin.defaultLanguage}"/>
  </bean>

  <bean id="adminConsoleLoginAccessResolver"
        class="com.enonic.vertical.adminweb.access.AdminConsoleLoginAccessResolver"/>

  <bean id="userServicesRedirectHelper"
        class="com.enonic.cms.web.portal.services.UserServicesRedirectUrlResolver"/>

  <bean id="reindexContentToolService"
        class="com.enonic.cms.core.tools.ReindexContentToolServiceImpl"/>

  <bean id="timeService" class="com.enonic.cms.core.time.SystemTimeService"/>

  <bean class="org.springframework.mail.javamail.JavaMailSenderImpl">
    <property name="host" value="${cms.mail.smtpHost}"/>
  </bean>

  <bean id="sendMailService" class="com.enonic.cms.core.mail.SendMailServiceImpl">
    <property name="fromMail" value="${cms.admin.email}"/>
  </bean>

  <bean id="loginService" class="com.enonic.cms.core.login.LoginServiceImpl">
    <property name="autologinTimeoutInDays" value="${com.enonic.vertical.presentation.autologinTimeout}"/>
  </bean>

  <bean id="localClient" class="com.enonic.cms.core.client.InternalClientImpl">
    <property name="clientForRemoteInvocations" value="false"/>
  </bean>

  <bean id="remoteClient" class="com.enonic.cms.core.client.InternalClientImpl">
    <property name="clientForRemoteInvocations" value="true"/>
  </bean>

  <bean id="internalClientContentService"
        class="com.enonic.cms.core.client.InternalClientContentService">
  </bean>

  <bean class="com.enonic.cms.core.client.LocalClientSetter">
    <property name="localClient" ref="localClient"/>
  </bean>

  <bean id="categoryService" class="com.enonic.cms.core.content.category.CategoryServiceImpl"/>

  <bean id="createAttachmentUrclFunction"
        class="com.enonic.cms.core.portal.rendering.portalfunctions.CreateAttachmentUrlFunction">
  </bean>

  <bean id="isWindowEmptyFunction"
        class="com.enonic.cms.core.portal.rendering.portalfunctions.IsWindowEmptyFunction">
    <property name="windowRendererFactory" ref="windowRendererFactory"/>
  </bean>

  <bean id="datasourceExecutorFactory" class="com.enonic.cms.core.portal.datasource.DatasourceExecutorFactory"/>

  <bean id="expressionFunctionsFactory"
        class="com.enonic.cms.core.portal.datasource.expressionfunctions.ExpressionFunctionsFactory"/>

  <bean id="imageService" class="com.enonic.cms.core.portal.image.ImageServiceImpl"/>

  <bean id="blobStore" class="com.enonic.cms.framework.blob.file.FileBlobStore"/>

  <bean id="fileResourceService" class="com.enonic.cms.store.resource.FileResourceServiceImpl"/>

  <bean id="blobStoreGarbageCollector" class="com.enonic.cms.framework.blob.gc.GarbageCollector"/>

  <bean id="usedBlobStoreFinder" class="com.enonic.cms.store.blob.DbUsedBlobKeyFinder"/>

  <bean id="portalFunctionsFactory"
        class="com.enonic.cms.core.portal.rendering.portalfunctions.PortalFunctionsFactory"/>

  <bean id="siteURLResolver" class="com.enonic.cms.core.SiteURLResolver"/>

  <bean class="com.enonic.cms.core.structure.SiteContextManager"/>

  <bean id="siteService" class="com.enonic.cms.core.structure.SiteServiceImpl"/>

  <bean id="autoLoginService" class="com.enonic.cms.core.security.AutoLoginService"/>

  <bean id="adminAjaxService" class="com.enonic.cms.server.service.admin.ajax.AdminAjaxServiceImpl"/>

  <bean id="davConfiguration" class="com.enonic.cms.web.webdav.DavConfiguration"/>

  <bean id="originalUrlResolver" class="com.enonic.cms.server.service.servlet.OriginalUrlResolver"/>

  <bean id="mbeanExporter" class="org.springframework.jmx.export.MBeanExporter">
    <property name="beans">
      <map>
        <entry key="EnonicCMS:type=Cache,name=Entity" value-ref="cacheEntity"/>
        <entry key="EnonicCMS:type=Cache,name=Page" value-ref="cachePage"/>
        <entry key="EnonicCMS:type=Cache,name=Binary" value-ref="cacheBinary"/>
        <entry key="EnonicCMS:type=Cache,name=Xslt" value-ref="cacheXslt"/>
        <entry key="EnonicCMS:type=Configuration,name=System"
               value-ref="systemProperties"/>
      </map>
    </property>
  </bean>

  <bean id="cacheEntity" class="com.enonic.cms.core.mbean.cache.Entity"/>
  <bean id="cachePage" class="com.enonic.cms.core.mbean.cache.Page"/>
  <bean id="cacheBinary" class="com.enonic.cms.core.mbean.cache.Binary"/>
  <bean id="cacheXslt" class="com.enonic.cms.core.mbean.cache.Xslt"/>

  <bean id="mbeanServerFactory" class="org.springframework.jmx.support.MBeanServerFactoryBean">
    <property name="locateExistingServerIfPossible" value="true"/>
  </bean>

  <bean id="systemProperties" class="com.enonic.cms.core.mbean.configuration.System"/>

  <bean id="siteListener" class="com.enonic.cms.core.mbean.configuration.SiteListener"
        depends-on="siteService"
        destroy-method="destroy">
    <property name="objectNamePrefix" value="EnonicCMS:type=Configuration,name="/>
  </bean>

  <bean id="portalRequestService" class="com.enonic.cms.core.portal.PortalRequestServiceImpl"/>

  <bean id="livePortalTraceService" class="com.enonic.cms.core.portal.livetrace.LivePortalTraceServiceImpl"/>

  <bean id="pageRequestProcessorFactory"
        class="com.enonic.cms.core.portal.processor.PageRequestProcessorFactory"/>

  <bean id="portalAccessService" class="com.enonic.cms.core.portal.PortalAccessService"/>

  <bean id="portletXsltViewTransformer"
        class="com.enonic.cms.core.portal.rendering.viewtransformer.PortletXsltViewTransformer"/>

  <bean id="pageTemplateXsltViewTransformer"
        class="com.enonic.cms.core.portal.rendering.viewtransformer.PageTemplateXsltViewTransformer"/>

  <bean id="pageRendererFactory" class="com.enonic.cms.core.portal.rendering.PageRendererFactory"/>

  <bean id="windowRendererFactory" class="com.enonic.cms.core.portal.rendering.WindowRendererFactory"/>

  <bean id="datasourcesContextXmlCreator"
        class="com.enonic.cms.core.portal.datasource.context.DatasourcesContextXmlCreator"/>

  <bean id="postProcessInstructionExecutor"
        class="com.enonic.cms.core.portal.instruction.PostProcessInstructionExecutorImpl"/>

  <bean id="datasourceInfoResolver" class="com.enonic.cms.core.tools.DataSourceInfoResolver"/>

  <bean class="com.enonic.cms.core.portal.cache.PageCacheServiceFactory"/>

  <bean id="siteCachesService" class="com.enonic.cms.core.portal.cache.SiteCachesServiceImpl"/>

  <bean id="adminService" class="com.enonic.cms.core.service.AdminServiceImpl"/>

  <bean id="presentationEngine" class="com.enonic.vertical.engine.PresentationEngine"/>
  <bean id="adminEngine" class="com.enonic.vertical.engine.AdminEngine"/>

  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.ContentArticle3XMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.GeneralContentXMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.ContentDocumentXMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.ContentEnhancedImageXMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.ContentFileXMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.ContentNewsletterXMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.ContentPollXMLBuilder"/>
  <bean class="com.enonic.vertical.adminweb.handlers.xmlbuilders.SimpleContentXMLBuilder"/>

  <bean class="com.enonic.vertical.engine.handlers.BinaryDataHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.ContentHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.CommonHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.CategoryHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.ContentObjectHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.GroupHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.LanguageHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.LogHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.MenuHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.PageHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.PageTemplateHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.SectionHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.SecurityHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.UnitHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.UserHandler"/>
  <bean class="com.enonic.vertical.engine.handlers.SystemHandler"/>

  <bean id="keyHandler" class="com.enonic.vertical.engine.handlers.KeyHandler">
    <property name="sessionFactory" ref="sessionFactory"/>
  </bean>

  <bean id="httpService" class="com.enonic.cms.core.http.HTTPService"/>

  <bean id="mimeTypeResolver" class="com.enonic.cms.framework.util.MimeTypeResolverImpl"/>

  <bean id="schedulerManager" class="com.enonic.vertical.work.quartz.QuartzSchedulerManager"/>

  <bean class="com.enonic.vertical.work.quartz.QuartzWorkService"/>

  <bean name="schedulerTranscationTemplate" class="org.springframework.transaction.support.TransactionTemplate">
    <property name="transactionManager" ref="transactionManager"/>
    <property name="propagationBehaviorName" value="PROPAGATION_REQUIRES_NEW"/>
    <property name="timeout" value="${cms.scheduler.tx.timeout}"/>
  </bean>

  <bean id="workRunner" class="com.enonic.vertical.work.WorkRunnerImpl">
    <property name="transactionTemplate" ref="schedulerTranscationTemplate"/>
  </bean>

</beans>
        